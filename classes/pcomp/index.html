<!DOCTYPE html>
<html lang="en">
<head>
    <title>Intro to Physical Computing • Nasif's ITP Blog</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.3/p5.min.js" defer></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.3/addons/p5.dom.min.js"></script> -->
    <!-- <script type="text/javascript" src="https://rawgit.com/patriciogonzalezvivo/glslCanvas/master/dist/GlslCanvas.js"></script> -->
    <link rel="stylesheet" type="text/css" href="../../style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
    <link href="https://fonts.googleapis.com/css2?family=Recursive:wght,CRSV,MONO@300..1000,0,0..1&family=Noto+Color+Emoji&display=block" rel="stylesheet"> 
    <meta name="description" content="Nasif's experience at the ITP Intro to Physical Computing course.">
    <meta name=”robots” content=”index, follow”>
    <link rel="icon" type="image/png" href="../../favicon.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8" />
</head>    
<body>
    <main class="page-container course-container">
        <hgroup>
            <p class="course-meta">Fall 2024 • Daniel Rozin</p>
            <h1 class="project-title">Physical Computing</h1>
        </hgroup>
        <div class="text-content">
            <div class="blog-week">
                <h2 class="project-subtitle">Week 02</h2>
                <p>This week we delved into inputs and outputs as well as serial communication. During class, Prof. Rozin recommended that students with previous knowledge in pcomp work beyond the labs to continue their learning.</p>
                <p>Therefore, I decided to develop a small project based on the USB capabilities of the nano to simulate a mouse and keyboard. I wanted to create a grid-like interface to control the mouse, setting the x & y of the mouse with sliders. This would allow me to practice using analog sensors and learn more of the mouse functions.</p>
                <div class="image-slide">
                    <figure>
                        <img loading="lazy" src="https://assets.nasif.co/una-sliders.webp" alt="Two slider potentiometers on top of a table.">
                        <figcaption>Una lent me these two sliders she got off of Amazon. She explained that they didn't really have a data sheet, and they had more than the usual pins.</figcaption>
                    </figure>
                    <figure>
                        <video controls loading="lazy" src="https://assets.nasif.co/measuring-slider.webm" alt="A multimeter connected to the leads of a slider potentiometer on a breadboard. A hand pushes the slider, which shows a reducing number on the multimeter screen."></video>
                        <figcaption>I set the multimeter to measure resistance and through trial and error managed to identify the three main pins of the slider.</figcaption>
                    </figure>
                    <figure>
                        <img loading="lazy" src="https://assets.nasif.co/slider-interface.webp" alt="Three breadboards side by side with an arduino nano, one slider potentiometer set horizontally and one vertically.">
                        <figcaption>I planned out the interface on my breadboards.</figcaption>
                    </figure>
                    <figure>
                        <img loading="lazy" src="https://assets.nasif.co/testing-one-slider.webp" alt="Three breadboards side by side with an arduino nano, one slider potentiometer set horizontally and one switch on the top right.">
                        <figcaption>I wired out the connections for one slider along with a switch, to be able to turn off control of the mouse if it all went sideways.</figcaption>
                    </figure>
                    
                </div>
                <p>At this point, I realized I had fundamentally misunderstood the <code>Mouse.move()</code> function. I thought that it would allow me to move the mouse to specific coordinates on the screen. Instead, it can just move the mouse <strong>relative to its previous position</strong>.</p>
                <p>This makes a lot of sense given how computer mice work. However, for me it was a big problem.</p>
                <p>With a lot of frustration, I figured out I needed to calm down. So I changed my small project to something that could calm me down: <strong>A slow breathing visualizer</strong>.</p>
                <p>The idea was to make a visual representation of my breath, guiding me through slow breathing excercises and relaxation:</p>
                <div class="image-slide">
                    <figure>
                        <img loading="lazy" src="https://assets.nasif.co/sound-sensor.webp" alt="Sound sensor and arduino on a breadboard.">
                        <figcaption>I connected a cheap sound sensor from years ago to use as the main sensor for my breath.</figcaption>
                    </figure>
                </div>
                <p>Because the sound sensor was such a cheap low quality component, the signal it gave was really noisey:</p>
                <div class="image-slide">
                    <figure>
                        <video controls src="https://assets.nasif.co/sound-sensor-raw.webm" alt="The Serial Plotter of the Arduino IDE, showing an erratic graph."></video>
                        <figcaption>Apart from the noise, I also noticed that when it detected sound, it would not only increase the reading value, it would also decrease it as well, acting like a kind of sound wave.</figcaption>
                    </figure>
                </div>
                <p>In order to clean it up and process it, I remembered a running average filter function I once used, created by researcher Mads Hobye and documented in <a href="http://www.diva-portal.org/smash/get/diva2:1404339/FULLTEXT01.pdf#page=195" target="_blank" rel="noopener noreferrer">his doctoral thesis</a>. I applied it to the sensor readings (along with a few other lines to remove the "wave" behavior from the values).</p>
                <div class="image-slide">
                    <figure>
                        <video loading="lazy" controls src="https://assets.nasif.co/sound-sensor-processed.webm" alt="The Serial Plotter of the Arduino IDE, showing a somewhat smooth graph."></video>
                        <figcaption>The function worked very well to clean up the noise. The downside is that it added some lag to the changes in value, but because it was for a breathing visualizer, this lag made everything look much smoother, which turned out to be a great advantage.</figcaption>
                    </figure>
                </div>
                <p>With the sensing out of the way, I needed to work on the actuation. I connected an old led matrix that would be used to visualize my breathing. To control it I used the <a href="https://github.com/michaelkubina/Arduino_MAX7219_LED_Matrix_Library" target="_blank" rel="noopener noreferrer">MAX7219 Library</a>.</p>
                <div class="image-slide">
                    <figure>
                        <video loading="lazy" controls src="https://assets.nasif.co/ledmatrix-test.webm" alt="Hand holding a breadboard with an LED 64 pixel screen. The screen goes through animations of a heart and the letter R."></video>
                        <figcaption>The example code from the library used, showing that all connections had been done correctly.</figcaption>
                    </figure>
                    <figure>
                        <img loading="lazy" src="https://assets.nasif.co/week2-circuit.webp" alt="A circuit on a breadboard consisting of an arduino nano, a sound sensor, an LED 64 pixel screen and a small push button.">
                        <figcaption>Knowing it was working, I organized the circuit on the breadboard and added a pushbutton that allow me to reset the value that the sound sensor recognized as 'silence'.</figcaption>
                    </figure>
                    <figure>
                        <img loading="lazy" src="https://assets.nasif.co/ledmatrix-paint.webp" alt="A screenshot of a web browser on a website with an image of an LED matrix.">
                        <figcaption>To design the animation on the LED matrix, I used the help of this website, to draw the lights and see what it would look like.</figcaption>
                    </figure>
                </div>
                <p>After finishing the code, my visualizer was done:</p>
                <div class="image-slide">
                    <figure>
                        <video loading="lazy" controls src="https://assets.nasif.co/breath-visualizer.webm" alt="Side view of an LED 64 pixel screen and the bottom of a face. When the person blows at the screen, it fills up with pixels from the center outwards. It returns to normal when the blowing stops."></video>
                    </figure>
                </div>
                <p>And this was my final code. A little bit messy but it worked well for a prototype:</p>
                <details>
                <summary>Show/hide code below</summary>
                <pre><code class="language-c++">
/*
    September 15-16 2024
    Nasif Rincón

    Relaxing breath visualizer
    A simple device that senses breath as sound and
    visualizes the depth of the breath by filling out
    an LED matrix screen.
*/

#include &lt;MAX7219.h&gt;
//Library: https://github.com/michaelkubina/Arduino_MAX7219_LED_Matrix_Library

//LED Matrix Variables
#define DATAPIN     18
#define CLOCKPIN    19
#define CSPIN       11

MAX7219 Matrix(1, DATAPIN, CLOCKPIN, CSPIN);

//Breath sensor variables
int raw = 0;
float filtered = 0;
int baseline = 520;

void setup() {
    Serial.begin(9600);
    pinMode(A3, INPUT);
    pinMode(5, INPUT_PULLUP);
    Matrix.clearDisplay(1);

    Matrix.setLed(1, 3, 3, true);
    Matrix.setLed(1, 4, 3, true);
    Matrix.setLed(1, 3, 4, true);
    Matrix.setLed(1, 4, 4, true);
}

void loop() {

    if (!digitalRead(5) == HIGH) {
        baseline = analogRead(A3);
        return;
    }

    raw = abs( baseline - analogRead(A3) );
    //Filtering based on the work of Mads Hobye http://www.diva-portal.org/smash/get/diva2:1404339/FULLTEXT01.pdf#page=195
    filtered = filtered * 0.999 + raw * 0.001;

    //Animation
    Matrix.clearDisplay(1);

    if ( filtered > 3 ) {
      levelFive();
    } else if ( filtered > 2.5 ) {
      levelFour();
    } else if ( filtered > 2 ) {
      levelThree();
    } else if ( filtered > 1.5 ) {
      levelTwo();
    } else if ( filtered > 1 ) {
      levelOne();
    } else {
      levelZero();
    }

    //Intensity
    Matrix.setIntensity(1, constrain(filtered, 1, 15) * 2 );
}

void levelZero() {
    Matrix.setLed(1, 3, 3, true);
    Matrix.setLed(1, 4, 3, true);
    Matrix.setLed(1, 3, 4, true);
    Matrix.setLed(1, 4, 4, true);
}

void levelOne() {
    for ( int row = 2; row < 6; row++ ) {
        for ( int col = 2; col < 6; col++ ) {
            if ( (col == 2 && row == 2) || (col == 5 && row == 2) || (col == 5 && row == 5) || (col == 2 && row == 5) ) {
                continue;
            }
            Matrix.setLed(1, row, col, true);
        }
    }
}

void levelTwo() {
    for ( int row = 1; row < 7; row++ ) {
        for ( int col = 1; col < 7; col++ ) {
            if ( (col == 1 && row == 1) || (col == 2 && row == 1) || (col == 5 && row == 1) || (col == 6 && row == 1) ||
                (col == 1 && row == 6) || (col == 2 && row == 6) || (col == 5 && row == 6) || (col == 6 && row == 6) ||
                (col == 1 && row == 2) || (col == 6 && row == 2) ||
                (col == 1 && row == 5) || (col == 6 && row == 5) ) {
                continue;
            }
            Matrix.setLed(1, row, col, true);
        }
    }
}


void levelThree() {
    for ( int row = 0; row < 8; row++ ) {
        for ( int col = 0; col < 8; col++ ) {
            if ( (col == 0 && row == 0) || (col == 1 && row == 0) || (col == 2 && row == 0) || (col == 5 && row == 0) || (col == 6 && row == 0) || (col == 7 && row == 0) ||
                (col == 0 && row == 1) || (col == 1 && row == 1) || (col == 6 && row == 1) || (col == 7 && row == 1) ||
                (col == 0 && row == 2) || (col == 7 && row == 2) ||
                (col == 0 && row == 5) || (col == 7 && row == 5) ||
                (col == 0 && row == 6) || (col == 1 && row == 6) || (col == 6 && row == 6) || (col == 7 && row == 6) ||
                (col == 0 && row == 7) || (col == 1 && row == 7) || (col == 2 && row == 7) || (col == 5 && row == 7) || (col == 6 && row == 7) || (col == 7 && row == 7) ) {
                continue;
            }
            Matrix.setLed(1, row, col, true);
        }
    }
}

void levelFour() {
    for ( int row = 0; row < 8; row++ ) {
        for ( int col = 0; col < 8; col++ ) {
            if ( (col == 0 && row == 0) || (col == 1 && row == 0) || (col == 6 && row == 0) || (col == 7 && row == 0) ||
                (col == 0 && row == 1) || (col == 7 && row == 1) ||
                (col == 0 && row == 6) || (col == 7 && row == 6) ||
                (col == 0 && row == 7) || (col == 1 && row == 7) || (col == 6 && row == 7) || (col == 7 && row == 7) ) {
                continue;
            }
            Matrix.setLed(1, row, col, true);
        }
    }
}

void levelFive() {
    for ( int row = 0; row < 8; row++ ) {
        for ( int col = 0; col < 8; col++ ) {
            Matrix.setLed(1, row, col, true);
        }
    }
}
                    </code></pre>
                </details>
            </div>
            <div class="blog-week">
                <h2 class="project-subtitle">Week 01</h2>
                <p>This first week was a refresher on the basic knowledge of electronics, through the development of some short practical labs and technical texts.</p>
                <div class="image-slide">
                    <figure>
                        <img loading="lazy" src="https://assets.nasif.co/variable-supply.webp" alt="Variable power supply reads 6.8V, 0.02A. The leads are connected to a multimeter in voltage reading mode. It reads 9.0V.">
                        <figcaption>I measured the variable supply before connecting it to the arduino. Was a bit surprised that the measurement on the multimeter was so different from the supply.</figcaption>
                    </figure>
                    <figure>
                        <img loading="lazy" src="https://assets.nasif.co/power-arduino.webp" alt="Arduino Nano IoT 33 on the edge of a breadboard. Connected with red and blue cables to a variable power supply that reads 6.8V.">
                        <figcaption>With the measured voltage, I connected the arduino through the VIN pin. Built-in LED flashed with the "blink" sketch, indicating it was running.</figcaption>
                    </figure>
                    <figure>
                        <img loading="lazy" src="https://assets.nasif.co/measure-arduino.webp" alt="Arduino Nano IoT 33 on the edge of a breadboard. Hands use a multimeter to measure two points on the breadboard, connected to vcc and ground. It reads 4.43V">
                        <figcaption>The board's VCC was measured as 4.43V, a bit high considering it is supposed to be 3.3V. Since I had never worked with a variable supply before, they might be something I'm overlooking.</figcaption>
                    </figure>
                </div>
                <p>Apart from those labs, I also measured the output voltage from an LM7805 when supplied power from the variable supply. The reading was once again very strange, which corroborated my suspicions that I must be misunderstanding something about the variable supply. I decided to switch to a standard supply for the next lab.</p>
                <div class="image-slide">
                    <figure>
                        <video loading="lazy" src="https://assets.nasif.co/fade-out-led.webm" controls></video>
                        <figcaption>I wired my blue LED as the provided diagram but decided to add a 4700μF capacitor in parallel with the LED. I thought this would cause it to both fade in and out, but it only faded out. I realized then that the fade in would be more complicated in these analog circuits, without PWM.</figcaption>
                    </figure>
                </div>
                <p>This fade out reminded me of Maywa Denki's machines, some of which have lights that power on instantly with the beats of his music, and then fade away. I decided then to make my switch music-related.</p>
                <p>The idea was to make a simple switch that turns on the light to the rhythm of your feet tapping, an action usually done semi-subconsciously when you connect with the music.</p>
                <div class="image-slide">
                    <figure>
                        <img loading="lazy" src="https://assets.nasif.co/switch-1.webp" alt="A copper plate with a wire on top of it, connected with a small strip of copper tape.">
                        <figcaption>The first layer of my soft switch sandwich.</figcaption>
                    </figure>
                    <figure>
                        <img loading="lazy" src="https://assets.nasif.co/switch-2.webp" alt="The foam piece of a headphone set on top of the copper plate.">
                        <figcaption>I used the foam of a headphone set as the dielectric for my soft switch.</figcaption>
                    </figure>
                    <figure>
                        <img loading="lazy" src="https://assets.nasif.co/switch-3.webp" alt="Copper plate with a wire connected with copper tape. All on top of the foam piece.">
                        <figcaption>Next I added another layer of copper.</figcaption>
                    </figure>
                    <figure>
                        <img loading="lazy" src="https://assets.nasif.co/switch-4.webp" alt="Soft switch built with two copper plates and a headphone piece foam in between.">
                        <figcaption>A little gaffer tape to hold it together.</figcaption>
                    </figure>
                </div>
                <p>After testing it out, I noticed it was very hard to create a connection when tapping, so I iterated:</p>
                <div class="image-slide">
                    <figure>
                        <img loading="lazy" src="https://assets.nasif.co/switch-iteration.webp" alt="Soft switch built with two copper plates and a headphone piece foam in between. It is opened up, showing a crumpled up piece of copper inside the middle hole of the foam piece.">
                        <figcaption>To fix that issue and make it easier to close the circuit, I added a crumpled piece of copper inside.</figcaption>
                    </figure>
                </div>
                <p>Then the final switch was ready:</p>
                <div class="image-slide">
                    <figure>
                        <video loading="lazy" src="https://assets.nasif.co/foot-switch-led.webm" controls></video>
                    </figure>
                </div>
                <p>It could definitely benefit from a debounce algorithm on the switch press detection, but I was satisfied with the result considering it was an analog circuit :).</p>
            </div>
        </div>
    </main>
    <script src="../../js/pixelBG.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
</body>
</html>